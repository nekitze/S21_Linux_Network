## Part 1. Инструмент ipcalc

1) Адрес сети 192.167.38.54/13<br>
    - ```192.160.0.0```<br>
    ![alt text](./images/1.png)


2) Перевод маски 255.255.255.0 в префиксную и двоичную запись, /15 в обычную и двоичную, 11111111.11111111.11111111.11110000 в обычную и префиксную<br> 
    - ```255.255.255.0 в префиксной: /24 ```<br> 
    ```255.255.255.0 в двоичной: 11111111.11111111.11111111.00000000```<br>
    ![alt text](./images/2.png)<br>
    - ```/15 в обычной: 255.254.0.0```<br>
    ```/15 в двоичной: 11111111.11111110.00000000.00000000```<br>
    ![alt text](./images/3.png)<br>
    - ```11111111.11111111.11111111.11110000 в обычной: 255.255.255.240```<br>
    ```11111111.11111111.11111111.11110000 в префиксной: /28 ```<br>
    ![alt text](./images/4.png)<br>

3) Минимальный и максимальный хост в сети 12.167.38.4 при масках: /8, 11111111.11111111.00000000.00000000, 255.255.254.0 и /4<br> 

    - ```На скрине минимальные и максимальные хосты по заданным маскам ```<br>
    ![alt text](./images/5.png)<br>

### 1.2. localhost

- 194.34.23.100 - нет
- 127.0.0.2 - да
- 127.1.0.1 - да
- 128.0.0.1 - нет

### 1.3. Диапазоны и сегменты сетей

1. какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных: <br>
    - 10.0.0.45 - частный
    - 134.43.0.2 - публичный
    - 192.168.4.2 - частный
    - 172.20.250.4 - частный
    - 172.0.2.1 - публичный
    - 192.172.0.1 - публичный
    - 172.68.0.2 - публичный
    - 172.16.255.255 - частный
    - 10.10.10.10 - частный
    - 192.169.168.1 - публичный


2. какие из перечисленных IP адресов шлюза возможны у сети 10.10.0.0/18: <br>
    - 10.0.0.1
    - 10.10.0.2 - возможен
    - 10.10.10.10 - возможен
    - 10.10.100.1
    - 10.10.1.255 - возможен

## Part 2. Статическая маршрутизация между двумя машинами

- ```ip a (ws1, ws2)```<br>
![alt text](./images/6.png)<br>


- ```Описан сетевой интерфейс, соответствующий внутренней сети, на обеих машинах и заданы следующие адреса и маски: ws1 - 192.168.100.10, маска /16, ws2 - 172.24.116.8, маска /12```<br>
![alt text](./images/7.png)<br>


- ```netplan apply```<br>
![alt text](./images/8.png)<br>

### 2.1. Добавление статического маршрута вручную


- ```Команды для добаления статического маршрута, пинг```<br>
![alt text](./images/9.png)<br>

### 2.2. Добавление статического маршрута с сохранением

- ```Изменённые файлы etc/netplan/00-installer-config.yaml```<br>
![alt text](./images/11.png)<br>

- ```Пропинговали ещё раз```<br>
![alt text](./images/10.png)<br>

## Part 3. Утилита iperf3

### 3.1. Скорость соединения

- 8 Mbps = 1 MB/s<br>
- 100 MB/s = 819200 Kbps<br>
- 1 Gbps = 1024 Mbps<br>

### 3.2. Утилита iperf3

- ```Скорость соединения между ws1 и ws2```<br>
![alt text](./images/12.png)<br>

## Part 4. Сетевой экран

### 4.1. Утилита iptables

- ```Правила в /etc/firewall.sh```<br>
![alt text](./images/13.png)<br>

- ```Запуска файлов на обеих машинах```<br>
![alt text](./images/14.png)<br>
- Если сначала стоит запрещающее правило, то оно имеет приоритет перед последующим разрешающим.


### 4.2. Утилита nmap

- ```Ping + nmap```<br>
![alt text](./images/15.png)<br>

## Part 5. Статическая маршрутизация сети

### Cкрины с содержанием файла etc/netplan/00-installer-config.yaml для каждой машины:
- ```WS11```<br>
![alt text](./images/16.png)<br>

- ```R1```<br>
![alt text](./images/17.png)<br>

- ```WS21```<br>
![alt text](./images/18.png)<br>

- ```WS22```<br>
![alt text](./images/19.png)<br>

- ```R2```<br>
![alt text](./images/20.png)<br>

### Если ошибок нет, то командой ip -4 a проверить, что адрес машины задан верно.

- ```WS11```<br>
![alt text](./images/21.png)<br>

- ```R1```<br>
![alt text](./images/22.png)<br>

- ```WS21```<br>
![alt text](./images/23.png)<br>

- ```WS22```<br>
![alt text](./images/24.png)<br>

- ```R2```<br>
![alt text](./images/25.png)<br>

### Пропинговать ws22 с ws21. Аналогично пропинговать r1 с ws11.

- ```WS22 c WS21```<br>
![alt text](./images/26.png)<br>

- ```R1 c WS11```<br>
![alt text](./images/27.png)<br>

### 5.2. Включение переадресации IP-адресов.
- ```sysctl -w net.ipv4.ip_forward=1 на роутерах```<br>
![alt text](./images/28.png)<br>

- ```net.ipv4.ip_forward=1 в /etc/sysctl.conf на роутерах```<br>
![alt text](./images/29.png)<br>

### 5.3. Установка маршрута по-умолчанию

Скрины etc/netplan/00-installer-config.yaml:<br>
- ```WS11 netplan```<br>
![alt text](./images/30.png)<br>

- ```WS21 netplan```<br>
![alt text](./images/31.png)<br>

- ```WS22 netplan```<br>
![alt text](./images/32.png)<br>

- ```Скрин выполнения команды ip r```<br>
![alt text](./images/33.png)<br>

- ```Пропинговали r2 с ws11```<br>
![alt text](./images/34.png)<br>

### 5.4. Добавление статических маршрутов

- ```netplan роутеров:```<br>
![alt text](./images/36.png)<br>

- ```Маршруты роутеров: (ip r)```<br>
![alt text](./images/35.png)<br>

- ```ip r list 10.10.0.0/[маска сети] и ip r list 0.0.0.0/0```<br>
![alt text](./images/37.png)<br>

- Для адреса 10.10.0.0/18 был выбран маршрут, отличный от 0.0.0.0/0, потому что при наличии нескольких маршрутов одинаковой длины выбирается тот маршрут, который задан наиболее точно.

### 5.5. Построение списка маршрутизаторов

- ```Вывод команд traceroute и tcpdump```<br>
![alt text](./images/38.png)<br>

Утилита Traceroute вместо ICMP-запроса отправляет 3 UDP-пакета на определенный порт целевого хоста и ожидает ответа о недоступности этого порта. Первый пакет отправляется с TTL=1, второй с TTL=2 и так далее, пока запрос не попадёт адресату. Так как вместо ICMP-запроса он отправляет UDP-запрос, в каждом запросе есть порт отправителя и порт получателя. По умолчанию запрос отправляется на закрытый порт 34434. Когда запрос попадёт на хост назначения, этот хост отправит ответ о недоступности порта «Destination port unreachable» (порт назначения недоступен). Это значит, что адресат получил запрос. Traceroute воспримет этот ответ как завершение трассировки.

### 5.6. Использование протокола ICMP при маршрутизации

- ```Пинг несуществующего ip, дамп с r1```<br>
![alt text](./images/39.png)<br>

## Part 6. Динамическая настройка IP с помощью DHCP

- ```1) указать адрес маршрутизатора по-умолчанию, DNS-сервер и адрес внутренней сети. Пример файла для r2:```<br>
![alt text](./images/41.png)<br>

- ```2) в файле resolv.conf прописать nameserver 8.8.8.8.```<br>
![alt text](./images/40.png)<br>

- ```Рестарт isc-dhcp-server```<br>
![alt text](./images/42.png)<br>

- ```После перезагрузки посмотрели, что адрес получили```<br>
![alt text](./images/43.png)<br>

- ```Пропинговали ws22 с ws21```<br>
![alt text](./images/44.png)<br>

- ```Измненный netplan ws11```<br>
![alt text](./images/45.png)<br>

- ```Настройка dhcpd.conf для r1```<br>
![alt text](./images/46.png)<br>

- ```Рестарт isc-dhcp-server для r1```<br>
![alt text](./images/47.png)<br>

- ```WS11 ip a после перезагрузки получили ip```<br>
![alt text](./images/48.png)<br>


- ```Запрос обновления ip```<br>
![alt text](./images/50.png)<br>
- ```ip WS21 до обновления```<br>
![alt text](./images/49.png)<br>
- ```ip WS21 после обновления```<br>
![alt text](./images/51.png)<br>

## Part 7. NAT

- ```В файле /etc/apache2/ports.conf на ws22 и r1 изменили строку Listen 80 на Listen 0.0.0.0:80, то есть сделали сервер Apache2 общедоступным```<br>
![alt text](./images/52.png)<br>

- ```Запуск серверов Apache2```<br>
![alt text](./images/53.png)<br>

- ```Пинг с ws22 до r1 не удаётся```<br>
![alt text](./images/54.png)<br>

- ```Успешно пропинговались с ws22 до r1 после разрешения маршрутизации icmp на r2```<br>
![alt text](./images/55.png)<br>

- ```Изменённый firewall.sh на r2```<br>
![alt text](./images/57.png)<br>

- ```Подключились с ws22 к серверу Apache на r1```<br>
![alt text](./images/56.png)<br>

- ```Подключились с r1 к серверу Apache на ws22```<br>
![alt text](./images/58.png)<br>

## Part 8. Дополнительно. Знакомство с SSH Tunnels

- ```Запустить на r2 фаервол с правилами из Части 7```<br> 
![alt text](./images/60.png)<br>

- ```Запустить веб-сервер Apache на ws22 только на localhost (то есть в файле /etc/apache2/ports.conf изменить строку Listen 80 на Listen localhost:80)```<br> 
![alt text](./images/61.png)<br>

- ```Воспользоваться Local TCP forwarding с ws21 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws21```<br>
![alt text](./images/62.png)<br>

- ```Воспользоваться Remote TCP forwarding c ws11 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws11 (прописываем именно с ws22)```<br>
![alt text](./images/64.png)<br>


- ```Подключились к серверу с ws21 до ws22```<br> 
![alt text](./images/59.png)<br>

- ```Подключились к серверу с ws11 до ws22```<br> 
![alt text](./images/65.png)<br>
